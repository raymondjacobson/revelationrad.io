<div id="album_info">
	<h3>Now Playing:</h3>
	<img class="album_art" src="http://2.bp.blogspot.com/-8iOMD241Ypo/Tjve9ESye7I/AAAAAAAAEIg/VUwqNiWcR9w/s1600/The+Shins+-+Oh%252C+Inverted+World+-+2001.jpg"/>
	<p>Girl Inform Me</p>
	<p>The Shins</p>
	<%= javascript_tag do %>
		song_links = new Array();
		song_ids = new Array();
	<% end %>
	<% @songs.each do |song| %>
	 	<% if song.music_file.url != '/music_files/original/missing.png' %>
			<p><%= song.music_file_file_name %> - <%= link_to "Drop", stream_song_path(@stream,song), method: :delete %></p>
			<audio id='song_<%=song.id %>' src=<%= song.music_file.url %> controls>
			<p>If you are reading this, it is because your browser does not support the audio element.</p>
			</audio>
			<%#=render 'streams/song_player' %>
			<%= javascript_tag do %>
				song_links.push("<%=song.music_file.url%>");
				song_ids.push("<%=song.id%>");
				$('#song_<%=song.id%>').bind('ended', function(){
			    $('#song_<%=song.id+1%>').get(0).play();
				});
			<% end %>
		<% end %>
	<% end %>
	<%= javascript_tag do %>
		console.log(song_ids[0]);
		console.log(song_links[0]);
	<% end %>
</div>
<div id="upload_box">
	<%= render 'songs/form' %>
</div>


<script type="text/javascript">
  $(document).ready(function(){
  	beginner = '#song_';
  	grab_id = beginner + song_ids[0];
		$(grab_id).bind('canplay', function(){
			$(this).get(0).currentTime=45;
		});
  	$(grab_id).get(0).play();
  	//update_current_time(grab_id);
  	var int=self.setInterval(function(){
  		update_current_time(grab_id, song_ids[0])}, 1000);
  });
	function update_song_list(){
		song_links.length = 0;
		"<% @songs.each do |song| %> "
			"<% if song.music_file.url != '/music_files/original/missing.png' %>"
				song_links.push("<%=song.music_file.url%>");
			"<% end %>"
		"<%end%>"
		return song_links;
	}

	function update_current_time(grab_id, id_r){
		time_r = $(grab_id).get(0).currentTime;
		$.ajax({
		  type: "POST",
		  url: "/update_time",
		  data: {time: time_r, id: id_r},
		  success: null
		});
		
		console.log("<%= @stream.current_song_time %>"+ "asdf");
		console.log($(grab_id).get(0).currentTime);
	}
	
	function play_next_song(id){
		
	}
</script>